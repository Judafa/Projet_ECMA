\documentclass[11pt,a4paper]{exam}

% For maths symbols
\usepackage{amsmath, amssymb, bm}
\usepackage{wasysym, bigints}
\usepackage{graphicx}
\usepackage{makecell}

% Langue
\usepackage[french]{babel}
\usepackage[T1]{fontenc}

\title{Modélisation Papier}
\author{Antonio Tavares, Julien Dallot}

%Define a length between lines in linear problems
\newlength{\interlinespace}\setlength{\interlinespace}{7mm}

\begin{document}
\maketitle

Dans la suite du document, la variable $x_{ij}$ désigne la sélection de l'arc $ij \in A$ dans le chemin de $s$ à $t$.

\begin{questions}
\question Voici le problème statique $\left(\mathcal{P}\right)$:
\begin{align*}
	\left(\mathcal{P}\right) \left\{
	\begin{array}{l c c l c c}
		&\min\limits_{x} &\sum\limits_{ij \in A} d_{ij} \: x_{ij}\\
		&\text{s.c.}\\
		% Contrainte 1
		& &\sum\limits_{ij \in A} p_{i} x_{ij} \quad + \quad p_{t} &\leq S & (1) & \text{(limite sur les sommets empruntés)}\\[\interlinespace]
		% Contrainte 2
		& &\sum\limits_{j \in \delta^{+}(i)} x_{ji} \ - \sum\limits_{j \in \delta^{-}(i)} x_{ij} &= 0 \quad \forall i \in V \setminus \{s, t\} & (2) & \text{(conservation du flot)}\\[\interlinespace]
		% Contrainte 3
		& &\sum\limits_{j \in \delta^{-}(s)} x_{sj} &= 1 & (3) &  \text{(un seul arc sortant de $s$)}\\[\interlinespace]
		% Contrainte 4
		& &\sum\limits_{j \in \delta^{+}(t)} x_{jt} &= 1 & (4) &  \text{(un seul arc rentrant dans $t$)}\\
	\end{array}
	\right.
\end{align*}

\question Modélisation du problème robuste $\left(\mathcal{P}_{r}\right)$:

\begin{align*}
	\left(\mathcal{P}_{r}\right) \left\{
	\begin{array}{l c c l c}
		&\min\limits_{x} \max\limits_{\delta^{1}} &\sum\limits_{ij \in A} d_{ij} \: (1 + \delta^{1}_{ij}) \: x_{ij}\\
		&\text{s.c.}\\
		% Contrainte 1
		& &\sum\limits_{ij \in A} p_{i} \: x_{ij} + \max\limits_{\delta^{2}}\left\{\delta^{2}_{t} \hat{p}_{t} + \sum\limits_{ij \in A} \delta^{2}_{i} \: \hat{p}_{i} \: x_{ij} \right\} &\leq S - p_{t} & (1_{robuste})\\[\interlinespace]
		% Contrainte 2
		& &\sum\limits_{j \in \delta^{+}(i)} x_{ji} \ - \sum\limits_{j \in \delta^{-}(i)} x_{ij} &= 0 \quad \forall i \in V \setminus \{s, t\} & (2_{robuste})\\[\interlinespace]
		% Contrainte 3
		& &\sum\limits_{j \in \delta^{-}(s)} x_{sj} &= 1 & (3_{robuste})\\[\interlinespace]
		% Contrainte 4
		& &\sum\limits_{j \in \delta^{+}(t)} x_{jt} &= 1 & (4_{robuste})\\
	\end{array}
	\right.
\end{align*}

\question Résolution par plans coupants et LazyCallback. On réexprime d'abord le problème robuste avec les ensembles $\mathcal{U}^{1*}$ et $\mathcal{U}^{2*}$.


\begin{align*}
\left(\mathcal{P}_{r}\right) \left\{
\begin{array}{l c c l c}
&\min\limits_{z} &z\\
&\text{s.c.}\\
% Contrainte 0
& &\sum\limits_{ij \in A} d^{1}_{ij} \: x_{ij} &\leq z  \quad \text{$\forall d^{1} \in \mathcal{U}^{1*}$} & (0)\\[\interlinespace]
% Contrainte 1
& &\sum\limits_{ij \in A} p^{2}_{i} x_{ij} \quad + \quad p^{2}_{t} &\leq S \quad \text{$\forall p^{2} \in \mathcal{U}^{2*}$} & (1_{robuste})\\[\interlinespace]
% Contrainte 2
& &\sum\limits_{j \in \delta^{+}(i)} x_{ji} \ - \sum\limits_{j \in \delta^{-}(i)} x_{ij} &= 0 \quad \forall i \in V \setminus \{s, t\} & (2_{robuste})\\[\interlinespace]
% Contrainte 3
& &\sum\limits_{j \in \delta^{-}(s)} x_{sj} &= 1 & (3_{robuste})\\[\interlinespace]
% Contrainte 4
& &\sum\limits_{j \in \delta^{+}(t)} x_{jt} &= 1 & (4_{robuste})\\
\end{array}
\right.
\end{align*}

Au début de l'algorithme de plans coupants, on peut choisir les ensembles de départ $\mathcal{U}^{1*}$ et $\mathcal{U}^{2*}$ suivants:
\begin{align*}
    \mathcal{U}^{1*} &= \left\{ \left\{ d^1_{ij} = d_{ij} \right\}_{ij \in A} \right\} \\
    \mathcal{U}^{2*} &= \left\{ \left\{ p^1_{i} = d_{i} \right\}_{i \in V} \right\} \\
\end{align*}

Il y a deux sous problèmes à résoudre, $(SP_{0})$ et $(SP_{1})$:


\begin{align*}
&\left(SP_{0}\right) \left\{
\begin{array}{l l}
 \max\limits_{\delta^{1}} &\sum\limits_{ij \in A} d_{ij} \ (1 + \delta^{1}_{ij}) \ x^{*}_{ij}\\
 \text{s.c}\\
 &\sum\limits_{ij \in A} \delta^{1}_{ij} \leq d_{1}\\[\interlinespace]
 &\delta^{1}_{ij} \leq D_{ij} \quad \forall ij \in A
 \end{array}
 \right.
&&\left(SP_{1}\right) \left\{
\begin{array}{l l}
 \max\limits_{\delta^{2}} &\sum\limits_{i \in V} (p_{i} + \delta^{2}_{i} \hat{p}_{i}) \ x^{*}_{ij} \quad + \quad p_{t} + \delta^{2}_{t} \hat{p}_{t}\\
\text{s.c}\\
&\sum\limits_{i \in V} \delta^{2}_{i} \leq d_{2}\\[\interlinespace]
&\delta^{2}_{i} \leq 2 \quad \forall i \in V
\end{array} \right.
\end{align*}

avec $x^{*}$ une solution courante du problème maître. Soient $\delta^{1*}$ et $\delta^{2*}$ des solutions optimales de $\left(SP_{0}\right)$ et $\left(SP_{1}\right)$, soit $z^{*}$ une solution optimale du problème maître courant. Cette solution du problème maître courant est l'optimale, ssi 

\begin{align*}
\begin{array}{lll}
	& &\sum\limits_{ij \in A} d_{ij} \ (1 + \delta^{1}_{ij}) \ x^{*}_{ij} \leq z^{*}\\
	&\text{et}\\
	& &\sum\limits_{i \in V} (p_{i} + \delta^{2}_{i} \hat{p}_{i}) \ x^{*}_{ij}\ +\ p_{t} + \delta^{2}_{t} \hat{p}_{t} \leq S
\end{array}
\end{align*}

À chaque itération, on ajoute les contraintes suivantes. Si $\sum\limits_{ij \in A} d_{ij} \ (1 + \delta^{1}_{ij}) \ x^{*}_{ij} > z^{*}$, alors on coupe cette mauvaise solution $x^{*}$ en rajoutant l'inégalité $\sum\limits_{ij \in A} d_{ij} \ (1 + \delta^{1}_{ij}) \ x_{ij} \leq z^{*}$. De même si $\sum\limits_{i \in V} (p_{i} + \delta^{2}_{i} \hat{p}_{i}) \ x^{*}_{ij}\ +\ p_{t} + \delta^{2}_{t} \hat{p}_{t} > S$, alors on rajoute l'inégalité $\sum\limits_{i \in V} (p_{i} + \delta^{2}_{i} \hat{p}_{i}) \ x_{ij}\ +\ p_{t} + \delta^{2}_{t} \hat{p}_{t} \leq S$. Si aucune de ces inégalités n'est violée, alors on a trouvé l'optimale pour le problème maître.

\question Résolution par dualisation.

\begin{align*}
\left(\mathcal{P}_{r}\right) \left\{
\begin{array}{l c c l c}
&\min\limits_{x} \: d_{ij} \: x_{ij} &+ \qquad \quad
%Deuxième problème
\left\{ \makecell[c]{ \begin{array}{l l}
	\max\limits_{\delta^{1}} &\sum\limits_{ij \in A} d_{ij} \ (1 + \delta^{1}_{ij}) \ x^{*}_{ij}\\
	\text{s.c}\\
	&\sum\limits_{ij \in A} \delta^{1}_{ij} \leq d_{1}\\[\interlinespace]
	&\delta^{1}_{ij} \leq D_{ij} \quad \forall ij \in A
	\end{array}} \right.\\
%Contraintes du problème maître
&\text{s.c.}\\
% Contrainte 1
& &\sum\limits_{ij \in A} p_{i} \: x_{ij} + \max\limits_{\delta^{2}}\left\{\delta^{2}_{t} \hat{p}_{t} + \sum\limits_{ij \in A} \delta^{2}_{i} \: \hat{p}_{i} \: x_{ij} \right\} &\leq S - p_{t} & (1_{robuste})\\[\interlinespace]
% Contrainte 2
& &\sum\limits_{j \in \delta^{+}(i)} x_{ji} \ - \sum\limits_{j \in \delta^{-}(i)} x_{ij} &= 0 \quad \forall i \in V \setminus \{s, t\} & (2_{robuste})\\[\interlinespace]
% Contrainte 3
& &\sum\limits_{j \in \delta^{-}(s)} x_{sj} &= 1 & (3_{robuste})\\[\interlinespace]
% Contrainte 4
& &\sum\limits_{j \in \delta^{+}(t)} x_{jt} &= 1 & (4_{robuste})\\
\end{array} \right.
\end{align*}

Isolation dans le problème robuste du terme faisant intervenir les variables $\delta^1_{ij}$ :

\begin{align*}
\min\limits_x \max\limits_{d^1} \sum\limits_{ij \in A} d_{ij}^1 \, x_{ij} &= \min\limits_x \max\limits_{\delta^1}\sum\limits_{ij \in A} d_{ij} \ (1 + \delta^{1}_{ij}) \ x_{ij}\\
&= \min\limits_x \left(\sum\limits_{ij \in A} d_{ij} \, x_{ij} + \max\limits_{\delta^1}\sum\limits_{ij \in A} d_{ij} \, \delta^{1}_{ij} \, x_{ij} \right)\\
\end{align*}

Problème interne lié aux variables $\delta^1_{ij}$ :

\begin{align*}
\left\{
\begin{array}{l l l c}
&\max\limits_{\delta^1} \: &\sum\limits_{ij \in A} d_{ij} \, \delta^{1}_{ij} \, x_{ij} \\
%Contraintes
&\text{s.c.}\\
% Contrainte 1
& &\sum\limits_{ij \in A} \delta^1_{ij} \leq d_1 \quad &(\alpha^{1})\\[\interlinespace]
% Contrainte 2
& &\delta^1_{ij} \leq D_{ij} \quad \forall ij \in A \quad &(\beta^{1}_{ij})
\end{array} \right.
\end{align*}


On dualise ce problème :

\begin{align*}
\left\{
\begin{array}{l l l l}
&\min\limits_{\alpha^{1}, \beta^{1}} \: & d_{1} \alpha^{1} + \sum\limits_{ij \in A} D_{ij} \beta^{1}_{ij} \\
%Contraintes
&\text{s.c.}\\
% Contrainte 1
& & \alpha^{1} + \beta^{1}_{ij} \geq d_{ij} x_{ij}  \quad \forall ij \in A &(\delta_{ij})
\end{array} \right.
\end{align*}

Reformulation de la contrainte robuste afin d'isoler le terme faisant intervenir les variables $\delta^1_{ij}$ :

\begin{align*}
&\sum\limits_{ij \in A} p^2_i \, x_{ij} + p^2_t \leq S \qquad p^2_i \in \mathcal{U}^2\\
&\text{qui se décompose en}\\
&\sum\limits_{ij \in A} \left( p_i + \delta^2_i \, \hat{p}_i \right) x_{ij} + p_t + \delta^2_t \, \hat{p}_t \leq S \\
&\text{et après passage au maximum par rapport à $\delta^{2}$}\\
&\sum\limits_{ij \in A}  p_i \, x_{ij} + \max\limits_{\delta^2} \left( \sum\limits_{ij \in A} \delta^2_i \hat{p}_i x_{ij} + \delta^2_t \hat{p}_t \right) \leq S \\
\end{align*}


Le problème interne lié aux variables $\delta^1_{ij}$ :

\begin{align*}
\left\{
\begin{array}{l l l c}
&\max\limits_{\delta^2} & \left( \sum\limits_{ij \in A} \delta^2_i \: \hat{p}_i \: x_{ij} + \delta^2_t \: \hat{p}_t \right) \\
%Contraintes
&\text{s.c.}\\
% Contrainte 1
& &\sum\limits_{i \in V} \delta^2_{i} \leq d_2 &(\alpha^{2})\\[\interlinespace]
% Contrainte 2
& &\delta^2_{i} \leq 2 \quad \forall i \in V &(\beta^{2}_{i})
\end{array} \right.
\end{align*}

Il faut le dualiser puis utiliser les deux dualisations pour présenter les problème robuste sous la forme d'un simple programme linéaire en nombre entiers.


\begin{align*}
\left\{
\begin{array}{l l l c}
&\min\limits_{\alpha^{2}, \beta^{2}} &d_{2} \alpha^{2} + \sum\limits_{i \in V} 2 \beta^{2}_{i}\\
%Contraintes
&\text{s.c.}\\
% Contrainte 1
& &\alpha^{2} + \beta^{2}_{i} \geq \hat{p}_{i} \: x_{ij} \quad \forall i \in V \setminus \{t\} &(\delta^{2}_{i})\\[\interlinespace]
% Contrainte 2
& &\alpha^{2} + \beta^{2}_{t} \geq \hat{p}_{i} &(\delta^{2}_{t})\\
\end{array} \right.
\end{align*}

On reformule le problème maître:

\begin{align*}
\left(\mathcal{P}_{r}\right) \left\{
\begin{array}{l c c l c}
&\min\limits_{x, \alpha^{1}, \beta^{1}} \: &d_{ij} \: x_{ij} + d_{1} \alpha^{1} + \sum\limits_{ij \in A} D_{ij} \beta^{1}_{ij} \\
%Contraintes du problème maître
&\text{s.c.}\\
% Contrainte 1
& &\sum\limits_{ij \in A} p_{i} \: x_{ij} + \min\limits_{\alpha^{2}, \beta^{2}} \left(d_{2} \alpha^{2} + \sum\limits_{i \in V} 2 \beta^{2}_{i}\right) &\leq S - p_{t} & (1_{robuste})\\[\interlinespace]
% Contrainte duale 
& &\alpha^{2} + \beta^{2}_{i} &\geq \hat{p}_{i} \: x_{ij} \quad \forall i \in V \setminus \{t\} &(\delta^{2}_{i})\\[\interlinespace]
& &\alpha^{2} + \beta^{2}_{t} &\geq \hat{p}_{i} &(\delta^{2}_{t})\\[\interlinespace]
% Contrainte 2
& &\sum\limits_{j \in \delta^{+}(i)} x_{ji} \ - \sum\limits_{j \in \delta^{-}(i)} x_{ij} &= 0 \quad \forall i \in V \setminus \{s, t\} & (2_{robuste})\\[\interlinespace]
% Contrainte 3
& &\sum\limits_{j \in \delta^{-}(s)} x_{sj} &= 1 & (3_{robuste})\\[\interlinespace]
% Contrainte 4
& &\sum\limits_{j \in \delta^{+}(t)} x_{jt} &= 1 & (4_{robuste})\\[\interlinespace]
& & \alpha^{1} + \beta^{1}_{ij} &\geq d_{ij} x_{ij}  \quad \forall ij \in A &(\delta_{ij})
\end{array} \right.
\end{align*}
~\\ \\
puis on peut supprimer le min dans la contrainte $(1_{robuste})$:\\

\begin{align*}
\left(\mathcal{P}_{r}\right) \left\{
\begin{array}{l c c l c}
&\min\limits_{x, \alpha^{1}, \beta^{1}} \: &d_{ij} \: x_{ij} + d_{1} \alpha^{1} + \sum\limits_{ij \in A} D_{ij} \beta^{1}_{ij} \\
%Contraintes du problème maître
&\text{s.c.}\\
% Contrainte 1
& &\sum\limits_{ij \in A} p_{i} \: x_{ij} + d_{2} \alpha^{2} + \sum\limits_{i \in V} 2 \beta^{2}_{i} &\leq S - p_{t} & (1_{robuste})\\[\interlinespace]
% Contrainte duale 
& &\alpha^{2} + \beta^{2}_{i} &\geq \hat{p}_{i} \: x_{ij} \quad \forall i \in V \setminus \{t\} &(\delta^{2}_{i})\\[\interlinespace]
& &\alpha^{2} + \beta^{2}_{t} &\geq \hat{p}_{i} &(\delta^{2}_{t})\\[\interlinespace]
% Contrainte 2
& &\sum\limits_{j \in \delta^{+}(i)} x_{ji} \ - \sum\limits_{j \in \delta^{-}(i)} x_{ij} &= 0 \quad \forall i \in V \setminus \{s, t\} & (2_{robuste})\\[\interlinespace]
% Contrainte 3
& &\sum\limits_{j \in \delta^{-}(s)} x_{sj} &= 1 & (3_{robuste})\\[\interlinespace]
% Contrainte 4
& &\sum\limits_{j \in \delta^{+}(t)} x_{jt} &= 1 & (4_{robuste})\\[\interlinespace]
& & \alpha^{1} + \beta^{1}_{ij} &\geq d_{ij} x_{ij}  \quad \forall ij \in A &(\delta_{ij})
\end{array} \right.
\end{align*}



\end{questions}

\end{document}

